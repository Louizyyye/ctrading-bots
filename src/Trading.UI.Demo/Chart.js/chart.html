<html>
<head>
    <script src="https://cdn.jsdelivr.net/npm/luxon@1.24.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.0.0-beta.9/dist/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@0.2.1"></script>
    <script src="./chartjs-chart-financial.js" type="text/javascript"></script>

    <style>
        #chartcontainer {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            flex-grow: 1;
        }

        canvas {
            -moz-user-select: none;
            -webkit-user-select: none;
            -ms-user-select: none;
            width: 100% !important;
            height: 100% !important;
        }
    </style>
</head>
<body>
    <div id="chartcontainer">
        <canvas id="canvas"></canvas>
    </div>
    <script>
        var ctx = document.getElementById('canvas').getContext('2d');
        ctx.canvas.width = 1000;
        ctx.canvas.height = 250;

        var getRandomInt = function (max) {
            return Math.floor(Math.random() * Math.floor(max));
        };

        function randomNumber(min, max) {
            return Math.random() * (max - min) + min;
        }

        function randomBar(date, lastClose) {
            var open = randomNumber(lastClose * 0.95, lastClose * 1.05).toFixed(2);
            var close = randomNumber(open * 0.95, open * 1.05).toFixed(2);
            var high = randomNumber(Math.max(open, close), Math.max(open, close) * 1.1).toFixed(2);
            var low = randomNumber(Math.min(open, close) * 0.9, Math.min(open, close)).toFixed(2);

            return {
                t: date.valueOf(),
                o: open,
                h: high,
                l: low,
                c: close
            };

        }

        function getRandomData(count) {
            var date = luxon.DateTime.fromRFC2822('01 Apr 2017 00:00 Z');
            var data = [randomBar(date, 30)];
            while (data.length < count) {
                date = date.plus({ days: 1 });
                if (date.weekday <= 5) {
                    data.push(randomBar(date, data[data.length - 1].c));
                }
            }
            return data;
        }

        var chart;

        function createChart(name, data) {

            if (chart == null) {
                chart = new Chart(ctx, {
                    type: 'candlestick',
                    data: {
                        datasets: [
                            {
                                label: name,
                                fillColor: "rgba(220,220,220,0.2)",
                                strokeColor: "rgba(220,220,220,1)",
                                pointColor: "rgba(220,220,220,1)",
                                pointStrokeColor: "#fff",
                                pointHighlightFill: "#fff",
                                pointHighlightStroke: "rgba(220,220,220,1)",
                                data: data
                            }
                        ]
                    }
                });
            }
            else {
                var newDataset = {
                    label: name,
                    fillColor: "rgba(220,220,220,0.2)",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "rgba(220,220,220,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(220,220,220,1)",
                    data: data
                };

                chart.data.datasets.pop();
                chart.data.datasets.push(newDataset);

                chart.update();
            }
        }
    </script>
</body>
</html>